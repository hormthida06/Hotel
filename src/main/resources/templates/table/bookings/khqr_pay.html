<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Confirm Your Reservation – Sabbay Kep</title>

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous"/>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
    <link rel="stylesheet" th:href="@{/css/qrPay.css}">
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>

<!-- Navbar -->
<th:block th:replace="layout/header.html :: header"></th:block>

<!-- Header -->
<section class="confirm-header " style="margin-top: 100px">
    <div class="container">
        <h1 class="display-4 fw-bold mb-3">Confirm & Pay with KHQR</h1>
        <p class="lead fs-4">Fast, secure, and fee-free in Cambodia – ready in seconds!</p>
    </div>
</section>

<!-- Main Content -->
<main class="container my-5">

    <div class="row g-5">
        <!-- Left: Summary -->
        <div class="col-lg-4">
            <div class="summary-card card p-4 p-md-5">
                <h3 class="fw-bold mb-4 text-center">
                    <i class="fas fa-clipboard-check me-2 text-success"></i>Reservation Summary
                </h3>

                <!-- Dates -->
                <div class="mb-4">
                    <h5><i class="fas fa-calendar-days me-2 text-primary"></i>Dates</h5>

                    <p class="mb-1">
                        Check-in:
                        <strong th:text="${#temporals.format(booking.checkIn, 'MMMM dd, yyyy')}">
                            Feb 15, 2026
                        </strong>
                    </p>

                    <p>
                        Check-out:
                        <strong th:text="${#temporals.format(booking.checkOut, 'MMMM dd, yyyy')}">
                            Feb 18, 2026
                        </strong>
                        (<span th:text="${nights}">3</span> nights)
                    </p>
                </div>

                <!-- Room & Guests -->
                <div class="mb-4">
                    <h5><i class="fas fa-bed me-2 text-primary"></i>Room & Guests</h5>
                    <p class="mb-1" th:text="${room.type}">
                        Garden View Bungalow
                    </p>
                    <p>
                        <span >2</span> adults •
                        <span >1</span> child •
                        <span >
                            Breakfast included
                        </span>
                    </p>
                    <!--                    <p>-->
                    <!--                        <span th:text="${room.adults}">2</span> adults •-->
                    <!--                        <span th:text="${room.children}">1</span> child •-->
                    <!--                        <span th:text="${room.breakfastIncluded ? 'Breakfast included' : 'No breakfast'}">-->
                    <!--                            Breakfast included-->
                    <!--                        </span>-->
                    <!--                    </p>-->
                </div>

                <!-- Guest (if user logged in) -->
                <div class="mb-4" th:if="${user != null}">
                    <h5><i class="fas fa-user me-2 text-primary"></i>Guest</h5>
                    <p>
                        <span th:text="${user.fullName}">Thida</span> •
                        <span th:text="${user.email}">thida@example.com</span>
                    </p>
                </div>

                <hr class="my-4">

                <!-- Total Amount -->
                <div class="d-flex justify-content-between align-items-center">
                    <h4 class="mb-0">Total Amount</h4>
                    <h3 class="fw-bold text-success mb-0"
                        th:text="'$' + ${booking.totalPrice}">
                        $00.00
                    </h3>
                </div>
                <p class="text-muted small text-end">(including taxes & fees)</p>
            </div>
        </div>

        <!-- Right: Payment Selection -->
            <div class="col-lg-8">
                <div class="payment-card card p-4 p-md-5">
                    <h3 class="fw-bold mb-4 text-center"><i class="fas fa-qrcode fa-2x me-2 text-primary"></i>Pay with KHQR</h3>
                    <p class="text-center lead mb-4">Instant transfer via your Cambodian banking app or Bakong Tourists App</p>

                    <!-- Steps -->
                    <ol class="steps-list mb-5">
                        <li><strong>Open your banking app</strong> that supports KHQR (e.g., ABA Mobile, ACLEDA app, Wing, Canadia, Pi Pay, Chief Mobile, or <strong>Bakong Tourists App</strong> for international visitors).</li>
                        <li><strong>Go to "Scan QR" or "Pay"</strong> section and scan the code below.</li>
                        <li><strong  th:text="'Verify amount'+' '+'$' + ${booking.totalPrice}"> $00.00</strong> or
                            <strong th:text="' '+'៛' + ${booking.totalPrice*4000}+' '"> </strong>and confirm payment.</li>
                        <li>Payment completes instantly – you'll see a success screen and we'll confirm your booking right away!</li>
                    </ol>

                    <!-- QR Code Area -->
                    <div class="qr-box mx-auto" style="max-width: 400px;">
                        <p class="fw-bold fs-5 mb-3">Scan to Pay Now<div ></div></p>
                        <p class="fw-bold fs-5 mb-3 text-primary" th:text="'$' + ${booking.totalPrice}">$00.00 </p>

                        <div class="qr-placeholder">
                            <img th:src="@{/img/photos/qr.jpg}" alt="KHQR Code" class="img-fluid">
                        </div>
                        <p class="small text-muted mt-3 mb-0">
                            Supported apps: ABA, ACLEDA, Wing, Canadia, Bakong Tourists (Visa/Mastercard link for foreigners), etc.<br>
                            For tourists: Download <a href="https://bakong.nbc.gov.kh/" target="_blank" class="text-primary">Bakong Tourists App</a> → register with email → top-up via card → scan & pay!
                        </p>
                    </div>

                    <hr class="my-5">

                    <!-- Final Actions -->
                    <div class="text-center">
                        <form th:action="@{/booking/khqr/complete/{id}(id=${booking.id})}" method="post">
                            <button class="btn btn-primary btn-lg px-5 py-3 mb-3" id="generate-qr-btn">
                                <i class="fas fa-qrcode me-2"></i> Payment Successful
                            </button>
                        </form>
<!--                            Generate & Show KHQR-->

                        <form th:action="@{/booking/payment/cancel}" method="post">
                            <input type="hidden" name="bookingId" th:value="${booking.id}" />
                            <button type="submit" class="btn btn-outline-danger btn-lg mb-3 w-30">
                                Cancel Booking
                            </button>
                        </form>

                        <p class="small text-muted">
                            By proceeding, you agree to our <a href="#" class="text-primary">terms</a> & <a href="#" class="text-primary">cancellation policy</a>.<br>
                            Questions? WhatsApp: +855 97 123 4567
                        </p>
                    </div>
                </div>
            </div>

    </div>

</main>

<!-- Footer -->
<th:block th:replace="layout/footer.html :: footer"></th:block>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

<script>
    document.querySelectorAll('.payment-option').forEach(opt => {
        opt.addEventListener('click', function() {
            document.querySelectorAll('.payment-option').forEach(o => o.classList.remove('active'));
            this.classList.add('active');
        });
    });

    document.getElementById('confirm-btn').addEventListener('click', function() {
        alert('Processing your reservation... (In real system: redirect to payment gateway)');
    });
</script>

</body>
</html>